{% extends "base.html" %}

{% block title %}
–ó–∞–∫—Ä–∏—Ç—Ç—è –ê—É–∫—Ü—ñ–æ–Ω—É
{% endblock %}

{% block content %}
<div class="container my-5 text-center">
    <h1 class="text-secondary fw-bold">üéâ –í—ñ—Ç–∞—î–º–æ! –ê—É–∫—Ü—ñ–æ–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–æ</h1>
    <p class="text-muted fs-5 mt-3">–í–∏ —É—Å–ø—ñ—à–Ω–æ –≤–∏–≥—Ä–∞–ª–∏ –∞—É–∫—Ü—ñ–æ–Ω! –û—Å—å –¥–µ—Ç–∞–ª—ñ:</p>

    <div class="card mt-4 border-0 shadow-sm">
        <div class="card-body">
            <h5 class="card-title text-success fw-bold">–î–µ—Ç–∞–ª—ñ –∞—É–∫—Ü—ñ–æ–Ω—É</h5>
            <ul class="list-group list-group-flush">
                <li class="list-group-item bg-light text-muted">
                    <strong>–ù–∞–∑–≤–∞:</strong> {{ auction.title }}
                </li>
                <li class="list-group-item bg-light text-muted">
                    <strong>–ü–µ—Ä–µ–º–æ–∂–µ—Ü—å:</strong> {{ current_user.username }} (–í–∏!)
                </li>
                <li class="list-group-item bg-light text-muted">
                    <strong>–ö—ñ–Ω—Ü–µ–≤–∞ —Ü—ñ–Ω–∞:</strong> ‚Ç¨{{ auction.current_price }}
                </li>
                <li class="list-group-item bg-light text-muted">
                    <strong>–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞:</strong> ‚Ç¨{{ auction.total_earnings }}
                </li>
                <li class="list-group-item bg-light text-muted">
                    <strong>–£—á–∞—Å–Ω–∏–∫—ñ–≤:</strong> {{ auction.total_participants }}
                </li>
            </ul>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥—ñ–π –¥–ª—è –ø–æ–∫—É–ø—Ü—è -->
    {% if current_user.id == auction.winner_id %}
    <div class="mt-4">
        <div class="alert alert-info">
            <h5>üìû –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:</h5>
            <p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ –ø—Ä–æ–¥–∞–≤—Ü—è —Ç–∞ –∑–≤'—è–∑–∞—Ç–∏—Å—è –∑ –Ω–∏–º –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É.</p>
        </div>
        
        <a href="{{ url_for('auction.auction_contact_details', auction_id=auction.id) }}" 
           class="btn btn-success btn-lg me-3">
            üìû –ö–æ–Ω—Ç–∞–∫—Ç–∏ –ø—Ä–æ–¥–∞–≤—Ü—è
        </a>
        
        {% if not auction.is_confirmed %}
        <button class="btn btn-warning btn-lg" onclick="confirmReceived({{ auction.id }})">
            ‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
        </button>
        {% else %}
        <span class="badge bg-success fs-6">‚úÖ –¢–æ–≤–∞—Ä –æ—Ç—Ä–∏–º–∞–Ω–æ</span>
        {% endif %}
    </div>
    {% endif %}

    <div class="mt-4">
        <a href="{{ url_for('main.index') }}" class="btn btn-secondary">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –Ω–∞ –≥–æ–ª–æ–≤–Ω—É</a>
        <a href="{{ url_for('user.buyer_dashboard', email=current_user.email) }}" class="btn btn-primary">–î–æ –ø–∞–Ω–µ–ª—ñ –ø–æ–∫—É–ø—Ü—è</a>
    </div>
</div>

<script>
async function confirmReceived(auctionId) {
    if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ –æ—Ç—Ä–∏–º–∞–ª–∏ —Ç–æ–≤–∞—Ä?')) return;
    
    try {
        const response = await fetch(`/auction/confirm-received/${auctionId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        const data = await response.json();
        if (response.ok) {
            alert('–î—è–∫—É—î–º–æ! –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ.');
            location.reload();
        } else {
            alert('–ü–æ–º–∏–ª–∫–∞: ' + data.error);
        }
    } catch (error) {
        alert('–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è: ' + error.message);
    }
}
</script>
{% endblock %}